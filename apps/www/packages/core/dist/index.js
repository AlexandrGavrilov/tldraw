var Dn=Object.create;var me=Object.defineProperty,Kn=Object.defineProperties,Xn=Object.getOwnPropertyDescriptor,Yn=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertyNames,Se=Object.getOwnPropertySymbols,$n=Object.getPrototypeOf,Oe=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var We=(i,e,t)=>e in i?me(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,g=(i,e)=>{for(var t in e||(e={}))Oe.call(e,t)&&We(i,t,e[t]);if(Se)for(var t of Se(e))_e.call(e,t)&&We(i,t,e[t]);return i},$=(i,e)=>Kn(i,Yn(e)),Qe=i=>me(i,"__esModule",{value:!0});var W=(i,e)=>{var t={};for(var n in i)Oe.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Se)for(var n of Se(i))e.indexOf(n)<0&&_e.call(i,n)&&(t[n]=i[n]);return t};var An=(i,e)=>{for(var t in e)me(i,t,{get:e[t],enumerable:!0})},Je=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Un(e))!Oe.call(i,o)&&(t||o!=="default")&&me(i,o,{get:()=>e[o],enumerable:!(n=Xn(e,o))||n.enumerable});return i},L=(i,e)=>Je(Qe(me(i!=null?Dn($n(i)):{},"default",!e&&i&&i.__esModule?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i),Nn=(i=>(e,t)=>i&&i.get(e)||(t=Je(Qe({}),e,1),i&&i.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var P=(i,e,t)=>(We(i,typeof e!="symbol"?e+"":e,t),t);var ao={};An(ao,{HTMLContainer:()=>so,Inputs:()=>w,Renderer:()=>ro,SVGContainer:()=>J,SnapPoints:()=>Ge,TLBoundsCorner:()=>Te,TLBoundsEdge:()=>fe,TLPerformanceMode:()=>Ve,TLShapeUtil:()=>Ae,Utils:()=>S,inputs:()=>oo});var Sn=require("mobx-react-lite"),V=L(require("react"));var U=L(require("react")),En=require("mobx-react-lite");var we=L(require("react")),he=we.createContext({});function E(){return we.useContext(he)}var G=L(require("react"));var ot=require("@use-gesture/react"),He=require("@tldraw/vec");var Ve=(o=>(o.TransformSelected="transform_selected",o.TranslateSelected="translate_selected",o.TransformAll="transform_all",o.TranslateAll="translate_all",o))(Ve||{}),fe=(o=>(o.Top="top_edge",o.Right="right_edge",o.Bottom="bottom_edge",o.Left="left_edge",o))(fe||{}),Te=(o=>(o.TopLeft="top_left_corner",o.TopRight="top_right_corner",o.BottomRight="bottom_right_corner",o.BottomLeft="bottom_left_corner",o))(Te||{}),Ge=(s=>(s.minX="minX",s.midX="midX",s.maxX="maxX",s.minY="minY",s.midY="midY",s.maxY="maxY",s))(Ge||{});var f=require("@tldraw/vec");String.prototype.replaceAll||(String.prototype.replaceAll=function(i,e){return Object.prototype.toString.call(i).toLowerCase()==="[object regexp]"?this.replace(i,e):this.replace(new RegExp(i,"g"),e)});var Ce=Math.PI*2,D=class{static lerp(e,t,n){return n=D.clamp(n,0,1),e*(1-n)+t*n}static lerpColor(e,t,n=.5){function o(l){let u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}function r(l){return"#"+((1<<24)+(l[0]<<16)+(l[1]<<8)+l[2]).toString(16).slice(1)}let s=o(e)||[0,0,0],a=o(t)||[0,0,0],d=s.slice();for(let l=0;l<3;l++)d[l]=Math.round(d[l]+n*(a[l]-s[l]));return r(d)}static modulate(e,t,n,o=!1){let[r,s]=t,[a,d]=n,l=a+(e-r)/(s-r)*(d-a);return o?a<d?Math.max(Math.min(l,d),a):Math.max(Math.min(l,a),d):l}static clamp(e,t,n){return Math.max(t,typeof n!="undefined"?Math.min(e,n):e)}static deepClone(e){if(e===null)return e;if(Array.isArray(e))return[...e];if(typeof e=="object"){let t=g({},e);return Object.keys(t).forEach(n=>t[n]=typeof e[n]=="object"?D.deepClone(e[n]):e[n]),t}return e}static rng(e=""){let t=0,n=0,o=0,r=0;function s(){let a=t^t<<11;return t=n,n=o,o=r,r^=(r>>>19^a^a>>>8)>>>0,r/4294967296}for(let a=0;a<e.length+64;a++)t^=e.charCodeAt(a)|0,s();return s}static pointsToLineSegments(e,t=!1){let n=[];for(let o=1;o<e.length;o++)n.push([e[o-1],e[o]]);return t&&n.push([e[e.length-1],e[0]]),n}static getRectangleSides(e,t,n=0){let o=[e[0]+t[0]/2,e[1]+t[1]/2],r=f.Vec.rotWith(e,o,n),s=f.Vec.rotWith(f.Vec.add(e,[t[0],0]),o,n),a=f.Vec.rotWith(f.Vec.add(e,t),o,n),d=f.Vec.rotWith(f.Vec.add(e,[0,t[1]]),o,n);return[["top",[r,s]],["right",[s,a]],["bottom",[a,d]],["left",[d,r]]]}static circleFromThreePoints(e,t,n){let[o,r]=e,[s,a]=t,[d,l]=n,u=o*(a-l)-r*(s-d)+s*l-d*a,p=(o*o+r*r)*(l-a)+(s*s+a*a)*(r-l)+(d*d+l*l)*(a-r),c=(o*o+r*r)*(s-d)+(s*s+a*a)*(d-o)+(d*d+l*l)*(o-s),m=-p/(2*u),v=-c/(2*u);return[m,v,Math.hypot(m-o,v-r)]}static perimeterOfEllipse(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return Math.PI*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}static shortAngleDist(e,t){let n=Math.PI*2,o=(t-e)%n;return 2*o%n-o}static longAngleDist(e,t){return Math.PI*2-D.shortAngleDist(e,t)}static lerpAngles(e,t,n){return e+D.shortAngleDist(e,t)*n}static angleDelta(e,t){return D.shortAngleDist(e,t)}static getSweep(e,t,n){return D.angleDelta(f.Vec.angle(e,t),f.Vec.angle(e,n))}static clampRadians(e){return(Math.PI*2+e)%(Math.PI*2)}static snapAngleToSegments(e,t){let n=Math.PI*2/t;return Math.floor((D.clampRadians(e)+n/2)/n)*n}static isAngleBetween(e,t,n){if(n===e||n===t)return!0;let o=(t-e+Ce)%Ce,r=(n-e+Ce)%Ce;return o<=Math.PI!=r>o}static degreesToRadians(e){return e*Math.PI/180}static radiansToDegrees(e){return e*180/Math.PI}static getArcLength(e,t,n,o){let r=D.getSweep(e,n,o);return t*(2*Math.PI)*(r/(2*Math.PI))}static getSweepFlag(e,t,n){let o=f.Vec.angle(e,n);return(f.Vec.angle(e,t)-o+3*Math.PI)%(2*Math.PI)-Math.PI>0?0:1}static getLargeArcFlag(e,t,n){let o=f.Vec.angle(n,e),s=(f.Vec.angle(n,t)-o+3*Math.PI)%(2*Math.PI)-Math.PI;return Math.abs(s)>Math.PI/2?0:1}static getArcDashOffset(e,t,n,o,r){let s=D.getSweepFlag(e,n,o),a=D.getArcLength(e,t,n,o);return-(s<0?a:2*Math.PI*e[2]-a)/2+r}static getEllipseDashOffset(e,t){return-(2*Math.PI*e[2])/2+-t}static pointInCircle(e,t,n){return f.Vec.dist(e,t)<=n}static pointInEllipse(e,t,n,o,r=0){r=r||0;let s=Math.cos(r),a=Math.sin(r),d=f.Vec.sub(e,t),l=s*d[0]+a*d[1],u=a*d[0]-s*d[1];return l*l/(n*n)+u*u/(o*o)<=1}static pointInRect(e,t){return!(e[0]<t[0]||e[0]>e[0]+t[0]||e[1]<t[1]||e[1]>e[1]+t[1])}static pointInPolygon(e,t){let n=0;return t.forEach((o,r)=>{let s=t[(r+1)%t.length];o[1]<=e[1]?s[1]>e[1]&&f.Vec.cross(o,s,e)>0&&(n+=1):s[1]<=e[1]&&f.Vec.cross(o,s,e)<0&&(n-=1)}),n!==0}static pointInBounds(e,t){return!(e[0]<t.minX||e[0]>t.maxX||e[1]<t.minY||e[1]>t.maxY)}static pointInPolyline(e,t,n=3){for(let o=1;o<t.length;o++)if(f.Vec.distanceToLineSegment(t[o-1],t[o],e)<n)return!0;return!1}static getBoundsSides(e){return this.getRectangleSides([e.minX,e.minY],[e.width,e.height])}static expandBounds(e,t){return{minX:e.minX-t,minY:e.minY-t,maxX:e.maxX+t,maxY:e.maxY+t,width:e.width+t*2,height:e.height+t*2}}static boundsCollide(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static boundsContain(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static boundsContained(e,t){return D.boundsContain(t,e)}static boundsAreEqual(e,t){return!(t.maxX!==e.maxX||t.minX!==e.minX||t.maxY!==e.maxY||t.minY!==e.minY)}static getBoundsFromPoints(e,t=0){let n=1/0,o=1/0,r=-1/0,s=-1/0;if(e.length<2)n=0,o=0,r=1,s=1;else for(let[a,d]of e)n=Math.min(a,n),o=Math.min(d,o),r=Math.max(a,r),s=Math.max(d,s);return t!==0?D.getBoundsFromPoints(e.map(a=>f.Vec.rotWith(a,[(n+r)/2,(o+s)/2],t))):{minX:n,minY:o,maxX:r,maxY:s,width:Math.max(1,r-n),height:Math.max(1,s-o)}}static centerBounds(e,t){let n=this.getBoundsCenter(e),o=t[0]-n[0],r=t[1]-n[1];return this.translateBounds(e,[o,r])}static snapBoundsToGrid(e,t){let n=Math.round(e.minX/t)*t,o=Math.round(e.minY/t)*t,r=Math.round(e.maxX/t)*t,s=Math.round(e.maxY/t)*t;return{minX:n,minY:o,maxX:r,maxY:s,width:Math.max(1,r-n),height:Math.max(1,s-o)}}static translateBounds(e,t){return{minX:e.minX+t[0],minY:e.minY+t[1],maxX:e.maxX+t[0],maxY:e.maxY+t[1],width:e.width,height:e.height}}static rotateBounds(e,t,n){let[o,r]=f.Vec.rotWith([e.minX,e.minY],t,n),[s,a]=f.Vec.rotWith([e.maxX,e.maxY],t,n);return{minX:o,minY:r,maxX:s,maxY:a,width:e.width,height:e.height}}static getRotatedEllipseBounds(e,t,n,o,r=0){let s=Math.cos(r),a=Math.sin(r),d=Math.hypot(n*s,o*a),l=Math.hypot(n*a,o*s);return{minX:e+n-d,minY:t+o-l,maxX:e+n+d,maxY:t+o+l,width:d*2,height:l*2}}static getExpandedBounds(e,t){let n=Math.min(e.minX,t.minX),o=Math.min(e.minY,t.minY),r=Math.max(e.maxX,t.maxX),s=Math.max(e.maxY,t.maxY),a=Math.abs(r-n),d=Math.abs(s-o);return{minX:n,minY:o,maxX:r,maxY:s,width:a,height:d}}static getCommonBounds(e){if(e.length<2)return e[0];let t=e[0];for(let n=1;n<e.length;n++)t=D.getExpandedBounds(t,e[n]);return t}static getRotatedCorners(e,t=0){let n=[e.minX+e.width/2,e.minY+e.height/2];return[[e.minX,e.minY],[e.maxX,e.minY],[e.maxX,e.maxY],[e.minX,e.maxY]].map(o=>f.Vec.rotWith(o,n,t))}static getTransformedBoundingBox(e,t,n,o=0,r=!1){let[s,a]=[e.minX,e.minY],[d,l]=[e.maxX,e.maxY],[u,p]=[e.minX,e.minY],[c,m]=[e.maxX,e.maxY];if(t==="center")return{minX:u+n[0],minY:p+n[1],maxX:c+n[0],maxY:m+n[1],width:c-u,height:m-p,scaleX:1,scaleY:1};let[v,T]=f.Vec.rot(n,-o);switch(t){case"top_edge":case"top_left_corner":case"top_right_corner":{p+=T;break}case"bottom_edge":case"bottom_left_corner":case"bottom_right_corner":{m+=T;break}}switch(t){case"left_edge":case"top_left_corner":case"bottom_left_corner":{u+=v;break}case"right_edge":case"top_right_corner":case"bottom_right_corner":{c+=v;break}}let y=d-s,R=l-a,h=(c-u)/y,b=(m-p)/R,K=h<0,Y=b<0,M=Math.abs(c-u),x=Math.abs(m-p);if(r){let B=y/R,C=B<M/x,H=M*(b<0?1:-1)*(1/B),N=x*(h<0?1:-1)*B;switch(t){case"top_left_corner":{C?p=m+H:u=c+N;break}case"top_right_corner":{C?p=m+H:c=u-N;break}case"bottom_right_corner":{C?m=p-H:c=u-N;break}case"bottom_left_corner":{C?m=p-H:u=c+N;break}case"bottom_edge":case"top_edge":{let k=(u+c)/2,Q=x*B;u=k-Q/2,c=k+Q/2;break}case"left_edge":case"right_edge":{let k=(p+m)/2,Q=M/B;p=k-Q/2,m=k+Q/2;break}}}if(o%(Math.PI*2)!==0){let B=[0,0],C=f.Vec.med([s,a],[d,l]),H=f.Vec.med([u,p],[c,m]);switch(t){case"top_left_corner":{B=f.Vec.sub(f.Vec.rotWith([c,m],H,o),f.Vec.rotWith([d,l],C,o));break}case"top_right_corner":{B=f.Vec.sub(f.Vec.rotWith([u,m],H,o),f.Vec.rotWith([s,l],C,o));break}case"bottom_right_corner":{B=f.Vec.sub(f.Vec.rotWith([u,p],H,o),f.Vec.rotWith([s,a],C,o));break}case"bottom_left_corner":{B=f.Vec.sub(f.Vec.rotWith([c,p],H,o),f.Vec.rotWith([d,a],C,o));break}case"top_edge":{B=f.Vec.sub(f.Vec.rotWith(f.Vec.med([u,m],[c,m]),H,o),f.Vec.rotWith(f.Vec.med([s,l],[d,l]),C,o));break}case"left_edge":{B=f.Vec.sub(f.Vec.rotWith(f.Vec.med([c,p],[c,m]),H,o),f.Vec.rotWith(f.Vec.med([d,a],[d,l]),C,o));break}case"bottom_edge":{B=f.Vec.sub(f.Vec.rotWith(f.Vec.med([u,p],[c,p]),H,o),f.Vec.rotWith(f.Vec.med([s,a],[d,a]),C,o));break}case"right_edge":{B=f.Vec.sub(f.Vec.rotWith(f.Vec.med([u,p],[u,m]),H,o),f.Vec.rotWith(f.Vec.med([s,a],[s,l]),C,o));break}}[u,p]=f.Vec.sub([u,p],B),[c,m]=f.Vec.sub([c,m],B)}return c<u&&([c,u]=[u,c]),m<p&&([m,p]=[p,m]),{minX:u,minY:p,maxX:c,maxY:m,width:c-u,height:m-p,scaleX:(c-u)/(d-s||1)*(K?-1:1),scaleY:(m-p)/(l-a||1)*(Y?-1:1)}}static getTransformAnchor(e,t,n){let o=e;switch(e){case"top_left_corner":{t&&n?o="bottom_right_corner":t?o="top_right_corner":n?o="bottom_left_corner":o="bottom_right_corner";break}case"top_right_corner":{t&&n?o="bottom_left_corner":t?o="top_left_corner":n?o="bottom_right_corner":o="bottom_left_corner";break}case"bottom_right_corner":{t&&n?o="top_left_corner":t?o="bottom_left_corner":n?o="top_right_corner":o="top_left_corner";break}case"bottom_left_corner":{t&&n?o="top_right_corner":t?o="bottom_right_corner":n?o="top_left_corner":o="top_right_corner";break}}return o}static getRelativeTransformedBoundingBox(e,t,n,o,r){let s=(o?t.maxX-n.maxX:n.minX-t.minX)/t.width,a=(r?t.maxY-n.maxY:n.minY-t.minY)/t.height,d=n.width/t.width,l=n.height/t.height,u=e.minX+e.width*s,p=e.minY+e.height*a,c=e.width*d,m=e.height*l;return{minX:u,minY:p,maxX:u+c,maxY:p+m,width:c,height:m}}static getRotatedSize(e,t){let n=f.Vec.div(e,2),o=[[0,0],[e[0],0],e,[0,e[1]]].map(s=>f.Vec.rotWith(s,n,t)),r=D.getBoundsFromPoints(o);return[r.width,r.height]}static getBoundsCenter(e){return[e.minX+e.width/2,e.minY+e.height/2]}static getBoundsWithCenter(e){let t=D.getBoundsCenter(e);return $(g({},e),{midX:t[0],midY:t[1]})}static getCommonTopLeft(e){let t=[1/0,1/0];return e.forEach(n=>{t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1])}),t}static getFromCache(e,t,n){let o=e.get(t);if(o===void 0&&(e.set(t,n()),o=e.get(t),o===void 0))throw Error("Cache did not include item!");return o}static uniqueId(e=""){return e?((Number(e)^Math.random()*16)>>Number(e)/4).toString(16):`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g,D.uniqueId)}static rotateArray(e,t){return e.map((n,o)=>e[(o+t)%e.length])}static debounce(e,t=0){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>e.apply(o),t)}}static getSvgPathFromStroke(e,t=!0){if(!e.length)return"";let n=e.length-1;return e.reduce((o,r,s,a)=>(s===n?t&&o.push("Z"):o.push(r,f.Vec.med(r,a[s+1])),o),["M",e[0],"Q"]).join(" ").replaceAll(this.TRIM_NUMBERS,"$1")}static getPerfectDashProps(e,t,n,o=1,r=!0,s=2){let a,d,l;if(n.toLowerCase()==="dashed")a=t*s,l=1,d=r?(a/2).toString():"0";else if(n.toLowerCase()==="dotted")a=t/100,l=100,d="0";else return{strokeDasharray:"none",strokeDashoffset:"none"};let u=Math.floor(e/a/(2*l));u-=u%o,u=Math.max(u,4);let p=Math.max(a,(e-u*a)/(r?u:u-1));return{strokeDasharray:[a,p].join(" "),strokeDashoffset:d}}static isMobileSize(){return typeof window=="undefined"?!1:window.innerWidth<768}static isMobileSafari(){if(typeof window=="undefined")return!1;let e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);return t&&n&&!e.match(/CriOS/i)}static throttle(e,t){let n,o;return function(...r){return n||(n=!0,setTimeout(()=>n=!1,t),o=e(...r)),o}}static isDarwin(){return/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)}static metaKey(e){return D.isDarwin()?e.metaKey:e.ctrlKey}static lns(e){let t=e.split("");return t.push(...t.splice(0,Math.round(t.length/5))),t.push(...t.splice(0,Math.round(t.length/4))),t.push(...t.splice(0,Math.round(t.length/3))),t.push(...t.splice(0,Math.round(t.length/2))),t.reverse().map(n=>+n?+n<5?5+ +n:+n>5?+n-5:n:n).join("")}},S=D;P(S,"getSnapPoints",(e,t,n)=>{let o=g({},e),r=[0,0],s=[],a={["minX"]:{id:"minX",isSnapped:!1},["midX"]:{id:"midX",isSnapped:!1},["maxX"]:{id:"maxX",isSnapped:!1},["minY"]:{id:"minY",isSnapped:!1},["midY"]:{id:"midY",isSnapped:!1},["maxY"]:{id:"maxY",isSnapped:!1}},d=["midX","minX","maxX"],l=["midY","minY","maxY"],u=t.map(T=>{let y=d.flatMap((h,b)=>d.map((K,Y)=>{let M=o[h]-T[K],x=Math.abs(M);return{f:h,t:K,gap:M,distance:x,isCareful:b===0||b+Y===3}})),R=l.flatMap((h,b)=>l.map((K,Y)=>{let M=o[h]-T[K],x=Math.abs(M);return{f:h,t:K,gap:M,distance:x,isCareful:b===0||b+Y===3}}));return[T,y,R]}),p=1/0,c=1/0,m=1/0,v=1/0;return u.forEach(([T,y,R])=>{y.forEach(h=>{h.distance<n&&h.distance<m&&(m=h.distance,p=h.gap)}),R.forEach(h=>{h.distance<n&&h.distance<v&&(v=h.distance,c=h.gap)})}),u.forEach(([T,y,R])=>{p!==1/0&&y.forEach(h=>{Math.abs(h.gap-p)<2&&(a[h.f]=$(g({},a[h.f]),{isSnapped:!0,to:T[h.t],B:T,distance:h.distance}))}),c!==1/0&&R.forEach(h=>{Math.abs(h.gap-c)<2&&(a[h.f]=$(g({},a[h.f]),{isSnapped:!0,to:T[h.t],B:T,distance:h.distance}))})}),r[0]=p===1/0?0:p,r[1]=c===1/0?0:c,o.minX-=r[0],o.midX-=r[0],o.maxX-=r[0],o.minY-=r[1],o.midY-=r[1],o.maxY-=r[1],d.forEach(T=>{let y=a[T];if(!y.isSnapped)return;let{id:R,B:h}=y,b=o[R];s.push(R==="minX"?[[b,o.midY],[b,h.minY],[b,h.maxY]]:[[b,o.minY],[b,o.maxY],[b,h.minY],[b,h.maxY]])}),l.forEach(T=>{let y=a[T];if(!y.isSnapped)return;let{id:R,B:h}=y,b=o[R];s.push(R==="midY"?[[o.midX,b],[h.minX,b],[h.maxX,b]]:[[o.minX,b],[o.maxX,b],[h.minX,b],[h.maxX,b]])}),{offset:r,snapLines:s}}),P(S,"deepMerge",(e,t)=>{let n=g({},e),o=Object.entries(t);for(let[r,s]of o)n[r]=s===Object(s)&&!Array.isArray(s)?D.deepMerge(n[r],s):s;return n}),P(S,"TRIM_NUMBERS",/(\s?[A-Z]?,?-?[0-9]*\.[0-9]{0,2})(([0-9]|e|-)*)/g);var I=S;function rt(i,e){let t=G.useRef(void 0),n=G.useRef(void 0),o=G.useRef([0,0]),{inputs:r,bounds:s,callbacks:a}=E();G.useEffect(()=>{let c=m=>m.preventDefault();return document.addEventListener("gesturestart",c),document.addEventListener("gesturechange",c),()=>{document.removeEventListener("gesturestart",c),document.removeEventListener("gesturechange",c)}},[]);let d=G.useCallback(({event:c})=>{var y,R,h,b;if(c.preventDefault(),r.isPinching)return;let{offset:m}=Wn(c);if((c.altKey||c.ctrlKey||c.metaKey)&&c.buttons===0){let Y=[...(R=(y=r.pointer)==null?void 0:y.point)!=null?R:[s.width/2,s.height/2],m[1]*.618],M=r.pan(Y,c);(h=a.onZoom)==null||h.call(a,$(g({},M),{delta:Y}),c);return}let v=He.Vec.mul(c.shiftKey&&!I.isDarwin?[m[1],0]:[...m],.5);if(He.Vec.isEqual(v,[0,0]))return;let T=r.pan(v,c);(b=a.onPan)==null||b.call(a,T,c)},[a,r,s]),l=G.useCallback(({origin:c,event:m})=>{var y;if(m instanceof WheelEvent)return;let v=e.current;if(!v||!(m.target===v||v.contains(m.target)))return;let T=r.pinch(c,c);r.isPinching=!0,(y=a.onPinchStart)==null||y.call(a,T,m),n.current=T.point,t.current=T.origin,o.current=[0,0]},[a,r,s]),u=G.useCallback(({origin:c,offset:m,event:v})=>{var h;if(v instanceof WheelEvent)return;let T=e.current;if(!(v.target===T||(T==null?void 0:T.contains(v.target)))||!t.current)return;let y=r.pinch(c,t.current),R=He.Vec.sub(y.delta,o.current);o.current=y.delta,(h=a.onPinch)==null||h.call(a,$(g({},y),{point:y.point,origin:t.current,delta:[...R,m[0]]}),v),n.current=c},[a,r,s]),p=G.useCallback(({origin:c,event:m})=>{var y;let v=e.current;if(!(m.target===v||(v==null?void 0:v.contains(m.target))))return;let T=r.pinch(c,c);r.isPinching=!1,(y=a.onPinchEnd)==null||y.call(a,T,m),n.current=void 0,t.current=void 0,o.current=[0,0]},[]);(0,ot.useGesture)({onWheel:d,onPinchStart:l,onPinch:u,onPinchEnd:p},{target:e,eventOptions:{passive:!1},pinch:{from:[i.current,0],scaleBounds:()=>({from:i.current,max:5,min:.1})}})}var et=10,tt=40,nt=800;function Wn(i){let e=0,t=0,n=0,o=0;return"detail"in i&&(t=i.detail),"wheelDelta"in i&&(t=-i.wheelDelta/120),"wheelDeltaY"in i&&(t=-i.wheelDeltaY/120),"wheelDeltaX"in i&&(e=-i.wheelDeltaX/120),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(e=t,t=0),n="deltaX"in i?i.deltaX:e*et,o="deltaY"in i?i.deltaY:t*et,(n||o)&&i.deltaMode&&(i.deltaMode==1?(n*=tt,o*=tt):(n*=nt,o*=nt)),n&&!e&&(e=n<1?-1:1),o&&!t&&(t=o<1?-1:1),{spin:[e,t],offset:[n,o]}}var it=require("react");function st(){let{callbacks:i}=E();(0,it.useEffect)(()=>{function e(){var t;(t=i.onShapeBlur)==null||t.call(i)}return I.isMobileSafari()?(document.addEventListener("focusout",e),()=>document.removeEventListener("focusout",e)):()=>null},[i])}var at=L(require("react"));function dt(){let{callbacks:i,inputs:e}=E();return at.useMemo(()=>({onPointerDown:t=>{var o,r;if(t.dead||(t.dead=!0,!e.pointerIsValid(t))||t.button!==0&&t.button!==1||!e.pointerIsValid(t))return;t.currentTarget.setPointerCapture(t.pointerId);let n=e.pointerDown(t,"canvas");(t.button===0||t.button===1)&&((o=i.onPointCanvas)==null||o.call(i,n,t),(r=i.onPointerDown)==null||r.call(i,n,t))},onPointerMove:t=>{var o,r;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;let n=e.pointerMove(t,"canvas");t.currentTarget.hasPointerCapture(t.pointerId)&&((o=i.onDragCanvas)==null||o.call(i,n,t)),(r=i.onPointerMove)==null||r.call(i,n,t)},onPointerUp:t=>{var r,s,a,d;if(t.dead||(t.dead=!0,t.button!==0&&t.button!==1)||(e.activePointer=void 0,!e.pointerIsValid(t)))return;let n=e.isDoubleClick(),o=e.pointerUp(t,"canvas");t.currentTarget.hasPointerCapture(t.pointerId)&&((r=t.currentTarget)==null||r.releasePointerCapture(t.pointerId)),n&&!(o.altKey||o.metaKey)&&((s=i.onDoubleClickCanvas)==null||s.call(i,o,t)),(a=i.onReleaseCanvas)==null||a.call(i,o,t),(d=i.onPointerUp)==null||d.call(i,o,t)},onDrop:i.onDrop,onDragOver:i.onDragOver}),[i,e])}var Ie=L(require("react"));function lt(i){let{rPageState:e,rSelectionBounds:t,callbacks:n,inputs:o}=Ie.useContext(he);return Ie.useMemo(()=>({onPointerDown:r=>{var a,d,l,u,p,c,m;if(r.dead||(r.dead=!0,!o.pointerIsValid(r)))return;if(r.button===2){(a=n.onRightPointShape)==null||a.call(n,o.pointerDown(r,i),r);return}if(r.button!==0)return;let s=o.pointerDown(r,i);if((d=r.currentTarget)==null||d.setPointerCapture(r.pointerId),t.current&&S.pointInBounds(s.point,t.current)&&!e.current.selectedIds.includes(i)){(l=n.onPointBounds)==null||l.call(n,o.pointerDown(r,"bounds"),r),(u=n.onPointShape)==null||u.call(n,s,r),(p=n.onPointerDown)==null||p.call(n,s,r);return}(c=n.onPointShape)==null||c.call(n,s,r),(m=n.onPointerDown)==null||m.call(n,s,r)},onPointerUp:r=>{var d,l,u,p;if(r.dead||(r.dead=!0,r.button!==0)||(o.activePointer=void 0,!o.pointerIsValid(r)))return;let s=o.isDoubleClick(),a=o.pointerUp(r,i);r.currentTarget.hasPointerCapture(r.pointerId)&&((d=r.currentTarget)==null||d.releasePointerCapture(r.pointerId)),s&&!(a.altKey||a.metaKey)&&((l=n.onDoubleClickShape)==null||l.call(n,a,r)),(u=n.onReleaseShape)==null||u.call(n,a,r),(p=n.onPointerUp)==null||p.call(n,a,r)},onPointerMove:r=>{var a,d;if(r.dead||(r.dead=!0,!o.pointerIsValid(r))||o.pointer&&r.pointerId!==o.pointer.pointerId)return;let s=o.pointerMove(r,i);r.currentTarget.hasPointerCapture(r.pointerId)&&((a=n.onDragShape)==null||a.call(n,s,r)),(d=n.onPointerMove)==null||d.call(n,s,r)},onPointerEnter:r=>{var a;if(!o.pointerIsValid(r))return;let s=o.pointerEnter(r,i);(a=n.onHoverShape)==null||a.call(n,s,r)},onPointerLeave:r=>{var a;if(!o.pointerIsValid(r))return;let s=o.pointerEnter(r,i);(a=n.onUnhoverShape)==null||a.call(n,s,r)}}),[o,n,i])}var ge=L(require("react"));var Le=require("@tldraw/vec");function ct(i,e,t,n,o,r=!1,s=!1,a){let d={shape:i,asset:i.assetId?o[i.assetId]:void 0,meta:a,isChildOfSelected:s,isGhost:i.isGhost||r,isEditing:n.editingId===i.id,isBinding:n.bindingTargetId===i.id,isSelected:n.selectedIds.includes(i.id),isHovered:n.hoveredId===i.id||i.children!==void 0&&(n.hoveredId&&i.children.includes(n.hoveredId)||i.children.some(l=>n.selectedIds.includes(l)))};e.push(d),i.children&&(d.children=[],i.children.map(l=>t[l]).filter(Boolean).sort((l,u)=>l.childIndex-u.childIndex).forEach(l=>ct(l,d.children,t,n,o,d.isGhost,d.isSelected||d.isChildOfSelected,a)))}function On(i,e){return S.boundsContain(e,i)||S.boundsCollide(e,i)}function ut(i,e,t,n){let{callbacks:o,shapeUtils:r,bounds:s}=E(),a=ge.useRef(),d=ge.useRef(-1),l=ge.useRef(new Set),u=ge.useRef(new Set),{selectedIds:p,camera:c}=e,[m,v]=Le.Vec.sub(Le.Vec.div([0,0],c.zoom),c.point),[T,y]=Le.Vec.sub(Le.Vec.div([s.width,s.height],c.zoom),c.point),R={minX:m,minY:v,maxX:T,maxY:y,height:T-m,width:y-v},h=u.current,b=l.current;h.clear(),b.clear(),Object.values(i.shapes).filter(x=>r[x.type].isStateful||p.includes(x.id)||On(r[x.type].getBounds(x),R)).forEach(x=>{if(x.parentId===i.id){b.add(x.id),h.add(x);return}let B=i.shapes[x.parentId];if(B===void 0)throw Error(`A shape (${x.id}) has a parent (${x.parentId}) that does not exist!`);b.add(B.id),h.add(B)}),h.size!==d.current&&(a.current&&clearTimeout(a.current),a.current=requestAnimationFrame(()=>{var x;(x=o.onRenderCountChange)==null||x.call(o,Array.from(b.values()))}),d.current=h.size);let Y=e.bindingId?i.bindings[e.bindingId].toId:void 0,M=[];return h.forEach(x=>{if(x===void 0)throw Error("Rendered shapes included a missing shape");ct(x,M,i.shapes,$(g({},e),{bindingTargetId:Y}),t,x.isGhost,!1,n)}),M.sort((x,B)=>x.shape.childIndex-B.shape.childIndex),M}var ve=L(require("react")),ze=new Map;function Vn(i,e){return Object.keys(e).reduce((t,n)=>{let o=e[n];return o?t+`${`--${i}-${n}`}: ${o};
`:t},"")}function Gn(i,e,t=":root"){ve.useLayoutEffect(()=>{let n=document.createElement("style"),o=Vn(i,e);return n.setAttribute("id",`${i}-theme`),n.setAttribute("data-selector",t),n.innerHTML=`
        ${t} {
          ${o}
        }
      `,document.head.appendChild(n),()=>{n&&document.head.contains(n)&&document.head.removeChild(n)}},[i,e,t])}function zn(i,e){ve.useLayoutEffect(()=>{if(ze.get(i))return()=>{};let t=document.createElement("style");return t.innerHTML=e,t.setAttribute("id",i),document.head.appendChild(t),ze.set(i,t),()=>{t&&document.head.contains(t)&&(document.head.removeChild(t),ze.delete(i))}},[i,e])}var Fn=(i,...e)=>i.reduce((t,n,o)=>t+n+(o<e.length?e[o]:""),""),jn={accent:"rgb(255, 0, 0)",brushFill:"rgba(0,0,0,.05)",brushStroke:"rgba(0,0,0,.25)",brushDashStroke:"rgba(0,0,0,.6)",selectStroke:"rgb(66, 133, 244)",selectFill:"rgba(65, 132, 244, 0.05)",binding:"rgba(65, 132, 244, 0.12)",background:"rgb(248, 249, 250)",foreground:"rgb(51, 51, 51)",grid:"rgba(144, 144, 144, 1)"},Zn=Fn`
  .tl-container {
    --tl-zoom: 1;
    --tl-scale: calc(1 / var(--tl-zoom));
    --tl-padding: calc(64px * max(1, var(--tl-scale)));
    --tl-performance-all: auto;
    --tl-performance-selected: auto;
    position: relative;
    top: 0px;
    left: 0px;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    box-sizing: border-box;
    padding: 0px;
    margin: 0px;
    z-index: 100;
    overflow: hidden;
    touch-action: none;
    overscroll-behavior: none;
    background-color: var(--tl-background);
  }
  .tl-container * {
    box-sizing: border-box;
  }
  .tl-overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    touch-action: none;
    pointer-events: none;
  }
  .tl-grid {
    position: absolute;
    width: 100%;
    height: 100%;
    touch-action: none;
    pointer-events: none;
    user-select: none;
  }
  .tl-snap-line {
    stroke: var(--tl-accent);
    stroke-width: calc(1px * var(--tl-scale));
  }
  .tl-snap-point {
    stroke: var(--tl-accent);
    stroke-width: calc(1px * var(--tl-scale));
  }
  .tl-canvas {
    position: absolute;
    width: 100%;
    height: 100%;
    touch-action: none;
    pointer-events: all;
    overflow: clip;
  }
  .tl-layer {
    position: absolute;
    top: 0px;
    left: 0px;
    height: 0px;
    width: 0px;
    contain: layout style size;
  }
  .tl-absolute {
    position: absolute;
    top: 0px;
    left: 0px;
    transform-origin: center center;
    contain: layout style size;
  }
  .tl-positioned {
    position: absolute;
    top: 0px;
    left: 0px;
    transform-origin: center center;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    contain: layout style size;
    will-change: var(--tl-performance-all);
  }
  .tl-positioned-svg {
    width: 100%;
    height: 100%;
    overflow: hidden;
    contain: layout style size;
  }
  .tl-positioned-div {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    padding: var(--tl-padding);
    overflow: hidden;
    contain: layout style size;
  }
  .tl-positioned-selected {
    will-change: var(--tl-performance-selected);
  }
  .tl-inner-div {
    position: relative;
    width: 100%;
    height: 100%;
  }
  .tl-stroke-hitarea {
    fill: none;
    stroke: transparent;
    stroke-width: calc(24px * var(--tl-scale));
    pointer-events: stroke;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .tl-fill-hitarea {
    fill: transparent;
    stroke: transparent;
    stroke-width: calc(24px * var(--tl-scale));
    pointer-events: all;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .tl-counter-scaled {
    transform: scale(var(--tl-scale));
  }
  .tl-dashed {
    stroke-dasharray: calc(2px * var(--tl-scale)), calc(2px * var(--tl-scale));
  }
  .tl-transparent {
    fill: transparent;
    stroke: transparent;
  }
  .tl-cursor-ns {
    cursor: ns-resize;
  }
  .tl-cursor-ew {
    cursor: ew-resize;
  }
  .tl-cursor-nesw {
    cursor: nesw-resize;
  }
  .tl-cursor-nwse {
    cursor: nwse-resize;
  }
  .tl-corner-handle {
    stroke: var(--tl-selectStroke);
    fill: var(--tl-background);
    stroke-width: calc(1.5px * var(--tl-scale));
  }
  .tl-rotate-handle {
    stroke: var(--tl-selectStroke);
    fill: var(--tl-background);
    stroke-width: calc(1.5px * var(--tl-scale));
    cursor: grab;
  }
  .tl-binding {
    fill: var(--tl-selectFill);
    stroke: var(--tl-selectStroke);
    stroke-width: calc(1px * var(--tl-scale));
    pointer-events: none;
  }
  .tl-user {
    left: calc(-15px * var(--tl-scale));
    top: calc(-15px * var(--tl-scale));
    height: calc(35px * var(--tl-scale));
    width: calc(35px * var(--tl-scale));
    transform: scale(var(--tl-scale));
    pointer-events: none;
    will-change: transform;
  }
  .tl-indicator {
    fill: transparent;
    stroke-width: calc(1.5px * var(--tl-scale));
    pointer-events: none;
  }
  .tl-user-indicator-bounds {
    border-style: solid;
    border-width: calc(1px * var(--tl-scale));
  }
  .tl-hovered {
    stroke: var(--tl-selectStroke);
  }
  .tl-selected {
    stroke: var(--tl-selectStroke);
  }
  .tl-locked {
    stroke-dasharray: calc(3px * var(--tl-scale)) calc(3px * var(--tl-scale));
  }
  .tl-editing {
    stroke-width: calc(2.5px * min(5, var(--tl-scale)));
  }
  .tl-performance {
    will-change: transform, contents;
  }
  .tl-clone-target {
    pointer-events: all;
  }
  .tl-clone-target:hover .tl-clone-button {
    opacity: 1;
  }
  .tl-clone-button-target {
    cursor: pointer;
    pointer-events: all;
  }
  .tl-clone-button-target:hover .tl-clone-button {
    fill: var(--tl-selectStroke);
  }
  .tl-clone-button {
    opacity: 0;
    r: calc(8px * var(--tl-scale));
    stroke-width: calc(1.5px * var(--tl-scale));
    stroke: var(--tl-selectStroke);
    fill: var(--tl-background);
  }
  .tl-bounds {
    pointer-events: none;
    contain: layout style size;
  }
  .tl-bounds-bg {
    stroke: none;
    fill: var(--tl-selectFill);
    pointer-events: all;
    contain: layout style size;
  }
  .tl-bounds-center {
    fill: transparent;
    stroke: var(--tl-selectStroke);
    stroke-width: calc(1.5px * var(--tl-scale));
  }
  .tl-brush {
    fill: var(--tl-brushFill);
    stroke: var(--tl-brushStroke);
    stroke-width: calc(1px * var(--tl-scale));
    pointer-events: none;
    contain: layout style size;
  }
  .tl-dashed-brush-line {
    fill: none;
    stroke: var(--tl-brushDashStroke);
    stroke-width: calc(1px * var(--tl-scale));
    pointer-events: none;
  }
  .tl-brush.dashed {
    stroke: none;
  }
  .tl-handle {
    pointer-events: all;
    cursor: grab;
  }
  .tl-handle:hover .tl-handle-bg {
    fill: var(--tl-selectFill);
  }
  .tl-handle:hover .tl-handle-bg > * {
    stroke: var(--tl-selectFill);
  }
  .tl-handle:active .tl-handle-bg {
    cursor: grabbing;
    fill: var(--tl-selectFill);
  }
  .tl-handle:active .tl-handle-bg > * {
    stroke: var(--tl-selectFill);
  }
  .tl-handle {
    fill: var(--tl-background);
    stroke: var(--tl-selectStroke);
    stroke-width: 1.5px;
  }
  .tl-handle-bg {
    fill: transparent;
    stroke: none;
    pointer-events: all;
    r: calc(16px / max(1, var(--tl-zoom)));
  }
  .tl-binding-indicator {
    fill: transparent;
    stroke: var(--tl-binding);
  }
  .tl-centered-g {
    transform: translate(var(--tl-padding), var(--tl-padding));
  }
  .tl-current-parent > *[data-shy='true'] {
    opacity: 1;
  }
  .tl-binding {
    fill: none;
    stroke: var(--tl-selectStroke);
    stroke-width: calc(2px * var(--tl-scale));
  }
  .tl-grid-dot {
    fill: var(--tl-grid);
  }
  .tl-erase-line {
    stroke-linejoin: round;
    stroke-linecap: round;
    pointer-events: none;
    fill: var(--tl-grid);
    opacity: 0.32;
  }
`;function pt(i,e){let t=ve.useMemo(()=>g(g({},jn),i),[i]);Gn("tl",t,e),zn("tl-canvas",Zn)}var se=L(require("react"));function F(i){let{callbacks:e,inputs:t}=E(),n=se.useCallback(d=>{var u,p,c;if(d.dead||(d.dead=!0,d.button!==0)||!t.pointerIsValid(d))return;let l=t.pointerDown(d,i);t.isDoubleClick()&&!(l.altKey||l.metaKey)&&((u=e.onDoubleClickBoundsHandle)==null||u.call(e,l,d)),(p=e.onPointBoundsHandle)==null||p.call(e,l,d),(c=e.onPointerDown)==null||c.call(e,l,d)},[t,e,i]),o=se.useCallback(d=>{var u,p;if(d.dead||(d.dead=!0,d.button!==0)||!t.pointerIsValid(d))return;let l=t.pointerUp(d,i);(u=e.onReleaseBoundsHandle)==null||u.call(e,l,d),(p=e.onPointerUp)==null||p.call(e,l,d)},[t,e,i]),r=se.useCallback(d=>{var u,p;if(d.dead||(d.dead=!0,!t.pointerIsValid(d)))return;d.currentTarget.hasPointerCapture(d.pointerId)&&((u=e.onDragBoundsHandle)==null||u.call(e,t.pointerMove(d,i),d));let l=t.pointerMove(d,i);(p=e.onPointerMove)==null||p.call(e,l,d)},[t,e,i]),s=se.useCallback(d=>{var l;!t.pointerIsValid(d)||(l=e.onHoverBoundsHandle)==null||l.call(e,t.pointerEnter(d,i),d)},[t,e,i]),a=se.useCallback(d=>{var l;!t.pointerIsValid(d)||(l=e.onUnhoverBoundsHandle)==null||l.call(e,t.pointerEnter(d,i),d)},[t,e,i]);return{onPointerDown:n,onPointerUp:o,onPointerEnter:s,onPointerMove:r,onPointerLeave:a}}var mt=require("mobx"),ye=L(require("react"));function ht(i,e,t){let n=ye.useRef(),o=ye.useRef();ye.useLayoutEffect(()=>(0,mt.autorun)(()=>{let{zoom:r,point:s}=t.camera,a=r!==n.current,d=s!==o.current;if(n.current=r,o.current=s,a||d){let l=i.current;if(e&&"current"in e){let u=e.current;a&&u&&u.style.setProperty("--tl-zoom",r.toString()),l&&l.style.setProperty("transform",`scale(${r}) translateX(${s[0]}px) translateY(${s[1]}px)`)}}}),[t])}var Tt=L(require("react"));function ft(i,e){return[(i[0]+e.point[0])*e.zoom,(i[1]+e.point[1])*e.zoom]}function Fe(i,e){return i[e.type]}function gt(i,e,t){let{rSelectionBounds:n}=E(),{selectedIds:o}=e,r=Tt.useRef(),s,a=0,d=!1,l=!1;if(o.length===1){let p=o[0],c=i.shapes[p];if(!c)throw Error(`selectedIds is set to the id of a shape that doesn't exist: ${p}`);a=c.rotation||0,d=c.isLocked||!1;let m=Fe(t,c);s=m.hideBounds?void 0:m.getBounds(c)}else if(o.length>1){let p=o.map(c=>i.shapes[c]);a=0,d=p.every(c=>c.isLocked),s=p.reduce((c,m,v)=>v===0?Fe(t,m).getRotatedBounds(m):I.getExpandedBounds(c,Fe(t,m).getRotatedBounds(m)),{})}if(s){let[p,c]=ft([s.minX,s.minY],e.camera),[m,v]=ft([s.maxX,s.maxY],e.camera);l=!!Object.values(i.bindings).find(T=>o.includes(T.toId)||o.includes(T.fromId)),n.current={minX:p,minY:c,maxX:m,maxY:v,width:m-p,height:v-c}}else n.current=null;let u=r.current;return!u||!s?r.current=s:s&&u.minX===s.minX&&u.minY===s.minY&&u.maxX===s.maxX&&u.maxY===s.maxY&&(s=r.current),{bounds:s,rotation:a,isLocked:d,isLinked:l}}var Lt=L(require("react"));function vt(i){let{inputs:e,callbacks:t}=E();return Lt.useMemo(()=>({onPointerDown:n=>{var r,s,a;if(n.dead||(n.dead=!0,!e.pointerIsValid(n))||n.button!==0||!e.pointerIsValid(n))return;(r=n.currentTarget)==null||r.setPointerCapture(n.pointerId);let o=e.pointerDown(n,i);(s=t.onPointHandle)==null||s.call(t,o,n),(a=t.onPointerDown)==null||a.call(t,o,n)},onPointerUp:n=>{var s,a,d,l;if(n.dead||(n.dead=!0,n.button!==0)||!e.pointerIsValid(n))return;let o=e.isDoubleClick(),r=e.pointerUp(n,i);n.currentTarget.hasPointerCapture(n.pointerId)&&((s=n.currentTarget)==null||s.releasePointerCapture(n.pointerId),o&&!(r.altKey||r.metaKey)&&((a=t.onDoubleClickHandle)==null||a.call(t,r,n)),(d=t.onReleaseHandle)==null||d.call(t,r,n)),(l=t.onPointerUp)==null||l.call(t,r,n)},onPointerMove:n=>{var r,s;if(n.dead||(n.dead=!0,!e.pointerIsValid(n)))return;let o=e.pointerMove(n,i);n.currentTarget.hasPointerCapture(n.pointerId)&&((r=t.onDragHandle)==null||r.call(t,o,n)),(s=t.onPointerMove)==null||s.call(t,o,n)},onPointerEnter:n=>{var r;if(!e.pointerIsValid(n))return;let o=e.pointerEnter(n,i);(r=t.onHoverHandle)==null||r.call(t,o,n)},onPointerLeave:n=>{var r;if(!e.pointerIsValid(n))return;let o=e.pointerEnter(n,i);(r=t.onUnhoverHandle)==null||r.call(t,o,n)}}),[e,t,i])}var yt=L(require("react"));function bt(i){let{bounds:e}=E();yt.useEffect(()=>{let t=r=>{r.preventDefault()},n=r=>{let s=r.touches[0].pageX,a=r.touches[0].radiusX||0;(s-a<10||s+a>e.width-10)&&r.preventDefault()},o=i.current;return o?(o.addEventListener("touchstart",t),o.addEventListener("gestureend",t),o.addEventListener("gesturechange",t),o.addEventListener("gesturestart",t),o.addEventListener("touchstart",n),()=>{o&&(o.removeEventListener("touchstart",t),o.removeEventListener("gestureend",t),o.removeEventListener("gesturechange",t),o.removeEventListener("gesturestart",t),o.removeEventListener("touchstart",n))}):()=>{}},[i,e.width])}var xt=L(require("react"));function Pt(){let{callbacks:i,inputs:e}=E();return xt.useMemo(()=>({onPointerDown:t=>{var o,r,s,a;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;if(t.button===2){(o=i.onRightPointBounds)==null||o.call(i,e.pointerDown(t,"bounds"),t);return}if(t.button!==0)return;(r=t.currentTarget)==null||r.setPointerCapture(t.pointerId);let n=e.pointerDown(t,"bounds");(s=i.onPointBounds)==null||s.call(i,n,t),(a=i.onPointerDown)==null||a.call(i,n,t)},onPointerUp:t=>{var r,s,a,d;if(t.dead||(t.dead=!0,t.button!==0)||(e.activePointer=void 0,!e.pointerIsValid(t)))return;let n=e.isDoubleClick(),o=e.pointerUp(t,"bounds");t.currentTarget.hasPointerCapture(t.pointerId)&&((r=t.currentTarget)==null||r.releasePointerCapture(t.pointerId)),n&&!(o.altKey||o.metaKey)&&((s=i.onDoubleClickBounds)==null||s.call(i,o,t)),(a=i.onReleaseBounds)==null||a.call(i,o,t),(d=i.onPointerUp)==null||d.call(i,o,t)},onPointerMove:t=>{var o,r;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;t.currentTarget.hasPointerCapture(t.pointerId)&&((o=i.onDragBounds)==null||o.call(i,e.pointerMove(t,"bounds"),t));let n=e.pointerMove(t,"bounds");(r=i.onPointerMove)==null||r.call(i,n,t)},onPointerEnter:t=>{var n;!e.pointerIsValid(t)||(n=i.onHoverBounds)==null||n.call(i,e.pointerEnter(t,"bounds"),t)},onPointerLeave:t=>{var n;!e.pointerIsValid(t)||(n=i.onUnhoverBounds)==null||n.call(i,e.pointerEnter(t,"bounds"),t)}}),[e,i])}var Rt=require("mobx"),Me=L(require("react"));function ke(i,e=0){let t=Me.useRef(null);return Me.useLayoutEffect(()=>(0,Rt.autorun)(()=>{let n=t.current,o=`
    translate(
      calc(${i.minX}px - var(--tl-padding)),
      calc(${i.minY}px - var(--tl-padding))
    )
    rotate(${e+(i.rotation||0)}rad)`;n.style.setProperty("transform",o),n.style.setProperty("width",`calc(${Math.floor(i.width)}px + (var(--tl-padding) * 2))`),n.style.setProperty("height",`calc(${Math.floor(i.height)}px + (var(--tl-padding) * 2))`)}),[i,e]),t}var Et=L(require("react"));function Bt(){let{inputs:i,callbacks:e}=E();Et.useEffect(()=>{let t=o=>{var r;(r=e.onKeyDown)==null||r.call(e,o.key,i.keydown(o),o)},n=o=>{var r;i.keyup(o),(r=e.onKeyUp)==null||r.call(e,o.key,i.keyup(o),o)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}},[i,e])}var je=L(require("@tldraw/vec")),z=L(require("react"));function St(i,e,t=!1){let n=z.useRef("idle"),o=z.useRef(e),r=z.useRef([]),s=z.useRef(performance.now()),a=z.useRef(0),d=z.useRef(0),[l]=z.useState(()=>new wt);z.useLayoutEffect(()=>{if(t){let m=i.current;if(!m)return;n.current="stopped",o.current=e,m.style.setProperty("transform",`translate(${e[0]}px, ${e[1]}px)`);return}let u=m=>{let v=performance.now();function T(){let y=(performance.now()-v)/m.duration;if(y<=1){let h=i.current;if(!h)return;let b=m.curve?l.getSplinePoint(y+m.start):je.default.lrp(m.from,m.to,y);h.style.setProperty("transform",`translate(${b[0]}px, ${b[1]}px)`),a.current=requestAnimationFrame(T);return}let R=r.current.shift();R?(n.current="animating",u(R)):(n.current="idle",d.current=setTimeout(()=>{n.current="stopped"},250))}T()},p=performance.now();n.current==="stopped"&&(s.current=p,o.current=e,l.clear()),l.addPoint(e);let c={distance:l.totalLength,curve:l.points.length>3,start:l.points.length-3,from:o.current,to:e,timeStamp:p,duration:Math.min(p-s.current,300)};switch(s.current=p,n.current){case"stopped":{o.current=e,n.current="idle";break}case"idle":{n.current="animating",u(c);break}case"animating":{o.current=e,r.current.push(c);break}}return()=>clearTimeout(d.current)},[t,e,l])}var wt=class{constructor(){P(this,"points",[]);P(this,"lengths",[]);P(this,"totalLength",0);P(this,"prev")}addPoint(e){if(this.prev){let t=je.default.dist(this.prev,e);this.lengths.push(t),this.totalLength+=t,this.points.push(e)}this.prev=e}getSplinePoint(e){let{points:t}=this,n=t.length-1,o=Math.trunc(e),r=Math.min(o+1,n),s=Math.min(r+1,n),a=Math.min(s+1,n),d=r-1;e=e-o;let l=e*e,u=l*e,p=-u+2*l-e,c=3*u-5*l+2,m=-3*u+4*l+e,v=u-l;return t[d]&&t[r]&&t[s]&&t[a]?[.5*(t[d][0]*p+t[r][0]*c+t[s][0]*m+t[a][0]*v),.5*(t[d][1]*p+t[r][1]*c+t[s][1]*m+t[a][1]*v)]:[0,0]}clear(){this.points=[],this.totalLength=0}};var Ct=L(require("react"));function Ht(i,e){Ct.useLayoutEffect(()=>{if(e&&"current"in e){let t=e==null?void 0:e.current;if(!t)return;switch(i){case"transform_selected":{t.style.setProperty("--tl-performance-all","auto"),t.style.setProperty("--tl-performance-selected","transform, contents");break}case"transform_all":{t.style.setProperty("--tl-performance-all","transform, contents"),t.style.setProperty("--tl-performance-selected","transform, contents");break}case"translate_selected":{t.style.setProperty("--tl-performance-all","auto"),t.style.setProperty("--tl-performance-selected","transform");break}case"translate_all":{t.style.setProperty("--tl-performance-all","transform"),t.style.setProperty("--tl-performance-selected","transform");break}default:t.style.setProperty("--tl-performance-all","auto"),t.style.setProperty("--tl-performance-selected","auto")}}},[i])}var kt=require("mobx-react-lite");var It=require("mobx-react-lite"),Mt=L(require("react"));var j=(0,It.observer)(function(d){var l=d,{id:e,bounds:t,rotation:n=0,isGhost:o=!1,isSelected:r=!1,children:s}=l,a=W(l,["id","bounds","rotation","isGhost","isSelected","children"]);let u=ke(t,n);return Mt.createElement("div",g({id:e,ref:u,className:`tl-positioned${o?" tl-ghost":""}${r?" tl-positioned-selected":""}`,"aria-label":"container","data-testid":"container"},a),s)});var Z=L(require("react"));var Dt=(0,kt.observer)(function({brush:e,zoom:t,dashed:n}){return Z.createElement(j,{bounds:e,rotation:0},Z.createElement(J,null,Z.createElement("rect",{className:"tl-brush"+(n?" dashed":""),opacity:1,x:0,y:0,width:e.width,height:e.height,"aria-label":"brush"}),n&&Z.createElement("g",{className:"tl-dashed-brush-line"},Z.createElement(De,{x1:0,y1:0,x2:e.width,y2:0,zoom:t}),Z.createElement(De,{x1:e.width,y1:0,x2:e.width,y2:e.height,zoom:t}),Z.createElement(De,{x1:0,y1:e.height,x2:e.width,y2:e.height,zoom:t}),Z.createElement(De,{x1:0,y1:0,x2:0,y2:e.height,zoom:t}))))});function De({x1:i,y1:e,x2:t,y2:n,zoom:o}){let r=I.getPerfectDashProps(Math.hypot(t-i,n-e),1/o,"dashed",1,!0,3);return Z.createElement("line",{x1:i,y1:e,x2:t,y2:n,strokeWidth:1/o,strokeDasharray:r.strokeDasharray,strokeDashoffset:r.strokeDashoffset})}var ln=require("mobx-react-lite"),_=L(require("react"));var X=L(require("react"));var Kt=require("mobx-react-lite"),Xt=L(require("react")),Yt=(0,Kt.observer)(function({bounds:e,isLocked:t,isHidden:n}){return Xt.createElement("rect",{className:["tl-bounds-center",t?"tl-dashed":""].join(" "),x:-1,y:-1,width:e.width+2,height:e.height+2,opacity:n?0:1,pointerEvents:"none","aria-label":"center handle"})});var Ut=require("mobx-react-lite"),Ke=L(require("react"));var $t=(0,Ut.observer)(function({bounds:e,targetSize:t,size:n,isHidden:o}){let r=F("rotate");return Ke.createElement("g",{cursor:"grab",opacity:o?0:1},Ke.createElement("circle",g({className:"tl-transparent","aria-label":"rotate handle transparent",cx:e.width/2,cy:n*-2,r:t,pointerEvents:o?"none":"all"},r)),Ke.createElement("circle",{className:"tl-rotate-handle","aria-label":"rotate handle",cx:e.width/2,cy:n*-2,r:n/2,pointerEvents:"none"}))});var At=require("mobx-react-lite"),Xe=L(require("react"));var qn={["top_left_corner"]:"tl-cursor-nwse",["top_right_corner"]:"tl-cursor-nesw",["bottom_right_corner"]:"tl-cursor-nwse",["bottom_left_corner"]:"tl-cursor-nesw"},be=(0,At.observer)(function({size:e,targetSize:t,isHidden:n,corner:o,bounds:r}){let s=F(o),a=o==="top_left_corner"||o==="top_right_corner",d=o==="top_left_corner"||o==="bottom_left_corner";return Xe.createElement("g",{opacity:n?0:1},Xe.createElement("rect",g({className:"tl-transparent "+(n?"":qn[o]),"aria-label":"corner transparent",x:(d?-1:r.width+1)-t,y:(a?-1:r.height+1)-t,width:t*2,height:t*2,pointerEvents:n?"none":"all"},s)),Xe.createElement("rect",{className:"tl-corner-handle","aria-label":"corner handle",x:(d?-1:r.width+1)-e/2,y:(a?-1:r.height+1)-e/2,width:e,height:e,pointerEvents:"none"}))});var q=L(require("react"));function Nt({size:i,bounds:e,isHidden:t}){let n=F("left"),o=F("center"),r=F("right");return q.createElement("g",{cursor:"grab",transform:`translate(${e.width/2-i*4}, ${e.height+i*2})`,"aria-label":"link handle"},q.createElement("g",{className:"tl-transparent",pointerEvents:t?"none":"all"},q.createElement("rect",g({x:0,y:0,width:i*2,height:i*2},n)),q.createElement("rect",g({x:i*3,y:0,width:i*2,height:i*2},o)),q.createElement("rect",g({x:i*6,y:0,width:i*2,height:i*2},r))),q.createElement("g",{className:"tl-rotate-handle",transform:`translate(${i/2}, ${i/2})`,"aria-label":"link rotate handle"},q.createElement("path",{d:`M 0,${i/2} L ${i},${i} ${i},0 Z`,pointerEvents:"none",opacity:t?0:1}),q.createElement("path",{transform:`translate(${i*3}, 0)`,d:`M 0,0 L ${i},0 ${i/2},${i} Z`,pointerEvents:"none",opacity:t?0:1}),q.createElement("path",{transform:`translate(${i*6}, 0)`,d:`M ${i},${i/2} L 0,0 0,${i} Z`,pointerEvents:"none",opacity:t?0:1})))}var Wt=require("mobx-react-lite"),Ot=L(require("react"));var _n={["top_edge"]:"tl-cursor-ns",["right_edge"]:"tl-cursor-ew",["bottom_edge"]:"tl-cursor-ns",["left_edge"]:"tl-cursor-ew"},xe=(0,Wt.observer)(function({size:e,isHidden:t,bounds:n,edge:o}){let r=F(o),s=o==="top_edge"||o==="bottom_edge",a=o==="right_edge"||o==="bottom_edge",{height:d,width:l}=n;return Ot.createElement("rect",g({pointerEvents:t?"none":"all",className:"tl-transparent tl-edge-handle "+(t?"":_n[o]),"aria-label":`${o} handle`,opacity:t?0:1,x:s?e/2:(a?l+1:-1)-e/2,y:s?(a?d+1:-1)-e/2:e/2,width:s?Math.max(0,l+1-e):e,height:s?e:Math.max(0,d+1-e)},r))});var O=L(require("react"));var Vt=require("mobx-react-lite"),ne=L(require("react"));var Qn={right:0,bottomRight:45,bottom:90,bottomLeft:135,left:180,topLeft:225,top:270,topRight:315},ee=(0,Vt.observer)(function({bounds:e,side:t,targetSize:n,size:o}){let r=n*2,s={left:-r,topLeft:-r,bottomLeft:-r,right:e.width,topRight:e.width,bottomRight:e.width,top:e.width/2-r/2,bottom:e.width/2-r/2}[t],a={left:e.height/2-r/2,right:e.height/2-r/2,top:-r*2,topLeft:-r,topRight:-r,bottom:e.height,bottomLeft:e.height,bottomRight:e.height}[t],{callbacks:d,inputs:l}=E(),u=ne.useCallback(p=>{var m;p.stopPropagation();let c=l.pointerDown(p,t);(m=d.onShapeClone)==null||m.call(d,c,p)},[d.onShapeClone]);return ne.createElement("g",{className:"tl-clone-target",transform:`translate(${s}, ${a})`,"aria-label":"clone button"},ne.createElement("rect",{className:"tl-transparent",width:n*2,height:n*2}),ne.createElement("g",{className:"tl-clone-button-target",onPointerDown:u,transform:`translate(${n}, ${n}) rotate(${Qn[t]})`},ne.createElement("circle",{className:"tl-transparent ",r:n}),ne.createElement("path",{className:"tl-clone-button",d:`M -${o/2},-${o/2} L ${o/2},0 -${o/2},${o/2} Z`,strokeLinejoin:"round"})))});function Gt({targetSize:i,size:e,bounds:t}){return O.createElement(O.Fragment,null,O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"top"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"right"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"bottom"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"left"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"topLeft"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"topRight"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"bottomLeft"}),O.createElement(ee,{targetSize:i,size:e,bounds:t,side:"bottomRight"}))}var zt=require("mobx-react-lite"),ae=L(require("react")),J=ae.forwardRef(function(s,r){var a=s,{id:e,className:t="",children:n}=a,o=W(a,["id","className","children"]);return ae.createElement(zt.Observer,null,()=>ae.createElement("svg",g({ref:r,className:`tl-positioned-svg ${t}`},o),ae.createElement("g",{id:e,className:"tl-centered-g"},n)))});var Ft=require("mobx-react-lite"),jt=(0,Ft.observer)(function({zoom:e,bounds:t,viewportWidth:n,rotation:o,isHidden:r,isLocked:s,hideCloneHandles:a,hideResizeHandles:d,hideRotateHandle:l,hideBindingHandles:u}){let p=(n<768?16:8)/e,c=8/e,m=Math.min(t.width,t.height)*e,v=!l&&!r&&!s&&m>32,T=!r&&!s&&m>24,y=!r&&!s&&m>20,R=!a&&m>24;return X.createElement(j,{bounds:t,rotation:o},X.createElement(J,null,X.createElement(Yt,{bounds:t,isLocked:s,isHidden:r}),!d&&!s?X.createElement(X.Fragment,null,X.createElement(xe,{targetSize:p,size:c,bounds:t,edge:"top_edge",isHidden:!T}),X.createElement(xe,{targetSize:p,size:c,bounds:t,edge:"right_edge",isHidden:!T}),X.createElement(xe,{targetSize:p,size:c,bounds:t,edge:"bottom_edge",isHidden:!T}),X.createElement(xe,{targetSize:p,size:c,bounds:t,edge:"left_edge",isHidden:!T}),X.createElement(be,{targetSize:p,size:c,bounds:t,isHidden:r||!y,corner:"top_left_corner"}),X.createElement(be,{targetSize:p,size:c,bounds:t,isHidden:r||!y,corner:"top_right_corner"}),X.createElement(be,{targetSize:p,size:c,bounds:t,isHidden:r||!y,corner:"bottom_right_corner"}),X.createElement(be,{targetSize:p,size:c,bounds:t,isHidden:r||!y,corner:"bottom_left_corner"})):null,v&&X.createElement($t,{targetSize:p,size:c,bounds:t,isHidden:!T}),R&&X.createElement(Gt,{bounds:t,targetSize:p,size:c}),!u&&X.createElement(Nt,{targetSize:p,size:c,bounds:t,isHidden:!T})))});var Zt=require("mobx-react-lite"),Ye=L(require("react"));var qt=(0,Zt.observer)(function({bounds:e,rotation:t,isHidden:n}){let o=Pt();return Ye.createElement(j,{bounds:e,rotation:t},Ye.createElement(J,null,Ye.createElement("rect",g({className:"tl-bounds-bg","aria-label":"bounds bg",width:e.width,height:e.height,opacity:n?0:1},o))))});var Jt=require("mobx-react-lite"),Pe=L(require("react")),Ue=require("@tldraw/vec");var de=L(require("react"));var _t=require("mobx-react-lite"),Qt=(0,_t.observer)(function({id:e,point:t}){let n=vt(e);return de.createElement(j,{bounds:I.translateBounds({minX:0,minY:0,maxX:0,maxY:0,width:0,height:0},t)},de.createElement(J,null,de.createElement("g",g({className:"tl-handle","aria-label":"handle"},n),de.createElement("circle",{className:"tl-handle-bg",pointerEvents:"all"}),de.createElement("circle",{className:"tl-counter-scaled tl-handle",pointerEvents:"none",r:4}))))});var en=(0,Jt.observer)(function({shape:e,zoom:t}){if(e.handles===void 0)return null;let n=null,o=Object.values(e.handles).reduce((r,s)=>{let a=Ue.Vec.add(s.point,e.point);return(!n||Ue.Vec.dist(a,n)*t>=32)&&(r.push(s),n=a),r},[]);return o.length===1?null:Pe.createElement(Pe.Fragment,null,o.map(r=>Pe.createElement(Qt,{key:e.id+"_"+r.id,id:r.id,point:Ue.Vec.add(r.point,e.point)})))});var sn=require("mobx-react-lite"),le=L(require("react"));var on=require("mobx-react-lite"),Ze=L(require("react"));var tn=require("mobx-react-lite"),$e=L(require("react")),Jn=(0,tn.observer)(function(e){let t=e.utils.getRef(e.shape);return $e.createElement(e.utils.Component,g({ref:t},e))}),nn=$e.memo(Jn,(i,e)=>i.isHovered!==e.isHovered||i.isSelected!==e.isSelected||i.isEditing!==e.isEditing||i.isBinding!==e.isBinding||i.isGhost!==e.isGhost||i.meta!==e.meta?!1:e.shape!==i.shape?!e.utils.shouldRender(e.shape,i.shape):!0);var rn=(0,on.observer)(function(r){var s=r,{shape:e,utils:t,meta:n}=s,o=W(s,["shape","utils","meta"]);let{callbacks:a}=E(),d=t.getBounds(e),l=lt(e.id);return Ze.createElement(j,{id:e.id,bounds:d,rotation:e.rotation,"data-shape":e.type,isGhost:o.isGhost,isSelected:o.isSelected},Ze.createElement(nn,g({shape:e,utils:t,meta:n,events:l,bounds:d,onShapeChange:a.onShapeChange,onShapeBlur:a.onShapeBlur},o)))});var an=(0,sn.observer)(function i(s){var a=s,{shape:e,utils:t,meta:n,children:o}=a,r=W(a,["shape","utils","meta","children"]);return le.createElement(le.Fragment,null,le.createElement(rn,g({shape:e,utils:t[e.type],meta:n},r)),o&&o.map(d=>le.createElement(i,g({key:d.shape.id,utils:t},d))))});var dn=require("mobx-react-lite"),Re=L(require("react"));var Ee=(0,dn.observer)(function({isHovered:e=!1,isSelected:t=!1,isEditing:n=!1,shape:o,user:r,meta:s}){let{shapeUtils:a}=E(),d=a[o.type],l=d.getBounds(o),u=ke(l,o.rotation);return Re.createElement("div",{ref:u,draggable:!1,className:["tl-indicator","tl-absolute",t&&!r?"tl-selected":"tl-hovered",n?"tl-editing":"",o.isLocked?"tl-locked":""].join(" ")},Re.createElement("svg",{width:"100%",height:"100%"},Re.createElement("g",{className:"tl-centered-g",stroke:r==null?void 0:r.color},Re.createElement(d.Indicator,{shape:o,meta:s,user:r,bounds:l,isSelected:t,isHovered:e}))))});var cn=(0,ln.observer)(function({page:e,pageState:t,assets:n,hideBounds:o,hideHandles:r,hideIndicators:s,hideBindingHandles:a,hideCloneHandles:d,hideRotateHandle:l,hideResizeHandles:u,meta:p}){let{bounds:c,shapeUtils:m}=E(),v=ut(e,t,n,p),{bounds:T,isLinked:y,isLocked:R,rotation:h}=gt(e,t,m),{selectedIds:b,hoveredId:K,editingId:Y,camera:{zoom:M}}=t,x=s,B=!0,C=!1,H,N=b.map(k=>e.shapes[k]);if(N.length===1){let k=N[0];C=Y===k.id,C&&(x=!0);let Q=m[k.type];B=d||!Q.showCloneHandles,k.handles!==void 0&&!C&&(H=k)}return _.createElement(_.Fragment,null,T&&_.createElement(qt,{bounds:T,rotation:h,isHidden:o}),v.map(k=>_.createElement(an,g({key:k.shape.id,utils:m},k))),!x&&N.map(k=>_.createElement(Ee,{key:"selected_"+k.id,shape:k,meta:p,isSelected:!0,isEditing:C})),!x&&K&&K!==Y&&_.createElement(Ee,{key:"hovered_"+K,shape:e.shapes[K],meta:p,isHovered:!0}),T&&_.createElement(jt,{zoom:M,bounds:T,viewportWidth:c.width,isLocked:R,rotation:h,isHidden:o,hideRotateHandle:l,hideResizeHandles:u,hideBindingHandles:a||!y,hideCloneHandles:B}),!r&&H&&_.createElement(en,{shape:H,zoom:M}))});var Be=L(require("react"));var A=L(require("react"));function un({user:i}){let e=A.useRef(null);return St(e,i.point,i.session),A.createElement("svg",{ref:e,className:"tl-absolute tl-user tl-counter-scaled",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 35 35",fill:"none",fillRule:"evenodd"},A.createElement("g",{fill:"rgba(0,0,0,.2)",transform:"translate(1,1)"},A.createElement("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),A.createElement("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})),A.createElement("g",{fill:"white"},A.createElement("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),A.createElement("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})),A.createElement("g",{fill:i.color},A.createElement("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),A.createElement("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})))}function pn({userId:i,users:e}){return Be.createElement(Be.Fragment,null,Object.values(e).filter(t=>t&&t.id!==i).map(t=>Be.createElement(un,{key:t.id,user:t})))}var mn=L(require("resize-observer-polyfill")),oe=L(require("react"));var eo=i=>{let e=i.parentElement;for(;e;){if(e===document.body)return document;let{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};function hn(i,e){let{inputs:t,callbacks:n}=E(),o=oe.useRef(!1),r=oe.useCallback(()=>{var s,a;if(o.current){let d=(s=i.current)==null?void 0:s.getBoundingClientRect();if(d){let l={minX:d.left,maxX:d.left+d.width,minY:d.top,maxY:d.top+d.height,width:d.width,height:d.height};t.bounds=l,e(l),(a=n.onBoundsChange)==null||a.call(n,l)}}else o.current=!0},[i,t,n.onBoundsChange]);oe.useEffect(()=>{let s=i.current?eo(i.current):document,a=S.debounce(r,100);return s.addEventListener("scroll",a),window.addEventListener("resize",a),()=>{s.removeEventListener("scroll",a),window.removeEventListener("resize",a)}},[]),oe.useEffect(()=>{let s=new mn.default(a=>{t.isPinching||a[0].contentRect&&r()});return i.current&&s.observe(i.current),()=>{s.disconnect()}},[i,t]),oe.useEffect(()=>{r()},[i])}var re=L(require("react"));function fn({userId:i,users:e,meta:t,page:n}){let{shapeUtils:o}=E();return re.createElement(re.Fragment,null,Object.values(e).filter(Boolean).filter(r=>r.id!==i&&r.selectedIds.length>0).map(r=>{let s=r.selectedIds.map(d=>n.shapes[d]).filter(Boolean);if(s.length===0)return null;let a=I.getCommonBounds(s.map(d=>o[d.type].getBounds(d)));return re.createElement(re.Fragment,{key:r.id+"_shapes"},re.createElement("div",{className:"tl-absolute tl-user-indicator-bounds",style:{backgroundColor:r.color+"0d",borderColor:r.color+"78",transform:`translate(${a.minX}px, ${a.minY}px)`,width:a.width,height:a.height,pointerEvents:"none"}}),s.map(d=>re.createElement(Ee,{key:`${r.id}_${d.id}_indicator`,shape:d,user:r,meta:t,isHovered:!0})))}))}var qe=require("mobx-react-lite"),te=L(require("react"));var Tn=(0,qe.observer)(function({snapLines:e}){return te.createElement(te.Fragment,null,e.map((t,n)=>te.createElement(to,{key:n,snapLine:t})))}),to=(0,qe.observer)(function({snapLine:e}){let t=I.getBoundsFromPoints(e);return te.createElement(te.Fragment,null,te.createElement("line",{className:"tl-snap-line",x1:t.minX,y1:t.minY,x2:t.maxX,y2:t.maxY}),e.map(([n,o],r)=>te.createElement("use",{key:r,href:"#tl-snap-point",x:n,y:o})))});var ce=L(require("react"));var gn=[[-1,.15,64],[.05,.375,16],[.15,1,4],[.7,2.5,1]];function Ln({grid:i,camera:e}){return ce.createElement("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ce.createElement("defs",null,gn.map(([t,n,o],r)=>{let s=o*i*e.zoom,a=e.point[0]*e.zoom,d=e.point[1]*e.zoom,l=a>0?a%s:s+a%s,u=d>0?d%s:s+d%s,p=e.zoom<n?I.modulate(e.zoom,[t,n],[0,1]):1;return ce.createElement("pattern",{key:`grid-pattern-${r}`,id:`grid-${r}`,width:s,height:s,patternUnits:"userSpaceOnUse"},ce.createElement("circle",{className:"tl-grid-dot",cx:l,cy:u,r:1,opacity:p}))})),gn.map((t,n)=>ce.createElement("rect",{key:`grid-rect-${n}`,width:"100%",height:"100%",fill:`url(#grid-${n})`})))}var vn=require("mobx-react-lite"),ue=L(require("react")),yn=(0,vn.observer)(function({camera:{zoom:e,point:t},children:n}){let o=2.5/e;return ue.createElement("svg",{className:"tl-overlay"},ue.createElement("defs",null,ue.createElement("g",{id:"tl-snap-point"},ue.createElement("path",{className:"tl-snap-point",d:`M ${-o},${-o} L ${o},${o} M ${-o},${o} L ${o},${-o}`}))),ue.createElement("g",{transform:`scale(${e}) translate(${t})`},n))});var bn=L(require("react")),xn=require("mobx-react-lite"),Pn=L(require("perfect-freehand"));var Rn=(0,xn.observer)(function({points:e,zoom:t}){if(e.length===0)return null;let n=I.getSvgPathFromStroke((0,Pn.default)(e,{size:16/t,start:{taper:!0}}));return bn.createElement("path",{d:n,className:"tl-erase-line"})});var Bn=(0,En.observer)(function({id:e,page:t,pageState:n,assets:o,snapLines:r,eraseLine:s,grid:a,users:d,userId:l,meta:u,performanceMode:p,externalContainerRef:c,showDashedBrush:m,hideHandles:v,hideBounds:T,hideIndicators:y,hideBindingHandles:R,hideCloneHandles:h,hideResizeHandles:b,hideRotateHandle:K,hideGrid:Y,onBoundsChange:M}){let x=U.useRef(null),B=U.useRef(n.camera.zoom);B.current=n.camera.zoom,rt(B,c||x),hn(x,M),st(),bt(x);let C=U.useRef(null),H=U.useRef(null);ht(H,C,n),Ht(p,C),Bt();let N=dt();return U.createElement("div",{id:e,className:"tl-container",ref:C},U.createElement("div",g({id:"canvas",className:"tl-absolute tl-canvas",ref:x},N),!Y&&a&&U.createElement(Ln,{grid:a,camera:n.camera}),U.createElement("div",{ref:H,className:"tl-absolute tl-layer","data-testid":"layer"},U.createElement(cn,{page:t,pageState:n,assets:o,hideBounds:T,hideIndicators:y,hideHandles:v,hideBindingHandles:R,hideCloneHandles:h,hideResizeHandles:b,hideRotateHandle:K,meta:u}),d&&l&&U.createElement(fn,{userId:l,users:d,page:t,meta:u}),n.brush&&U.createElement(Dt,{brush:n.brush,dashed:m,zoom:n.camera.zoom}),d&&U.createElement(pn,{userId:l,users:d})),U.createElement(yn,{camera:n.camera},s&&U.createElement(Rn,{points:s,zoom:n.camera.zoom}),r&&U.createElement(Tn,{snapLines:r}))))});var ie=require("@tldraw/vec"),no=250,w=class{constructor(){P(this,"pointer");P(this,"keyboard");P(this,"keys",{});P(this,"isPinching",!1);P(this,"bounds",{minX:0,maxX:640,minY:0,maxY:480,width:640,height:480});P(this,"pointerUpTime",0);P(this,"activePointer");P(this,"panStart",e=>{var a,d;let{shiftKey:t,ctrlKey:n,metaKey:o,altKey:r}=e,s={target:"wheel",pointerId:((a=this.pointer)==null?void 0:a.pointerId)||0,origin:((d=this.pointer)==null?void 0:d.origin)||[0,0],delta:[0,0],pressure:.5,point:w.getPoint(e,this.bounds),shiftKey:t,ctrlKey:n,metaKey:o,altKey:r,spaceKey:this.keys[" "]};return this.pointer=s,s});P(this,"pan",(e,t)=>{if(!this.pointer||this.pointer.target!=="wheel")return this.panStart(t);let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=t,a=this.pointer,d=w.getPoint(t,this.bounds),l=$(g({},a),{target:"wheel",delta:e,point:d,shiftKey:n,ctrlKey:o,metaKey:r,altKey:s,spaceKey:this.keys[" "]});return this.pointer=l,l});P(this,"keydown",e=>{var s,a;let{shiftKey:t,ctrlKey:n,metaKey:o,altKey:r}=e;return this.keys[e.key]=!0,{point:((s=this.pointer)==null?void 0:s.point)||[0,0],origin:((a=this.pointer)==null?void 0:a.origin)||[0,0],key:e.key,keys:Object.keys(this.keys),shiftKey:t,ctrlKey:n,metaKey:S.isDarwin()?o:n,altKey:r}});P(this,"keyup",e=>{var s,a;let{shiftKey:t,ctrlKey:n,metaKey:o,altKey:r}=e;return delete this.keys[e.key],{point:((s=this.pointer)==null?void 0:s.point)||[0,0],origin:((a=this.pointer)==null?void 0:a.origin)||[0,0],key:e.key,keys:Object.keys(this.keys),shiftKey:t,ctrlKey:n,metaKey:S.isDarwin()?o:n,altKey:r}})}pointerIsValid(e){if("pointerId"in e&&this.activePointer&&this.activePointer!==e.pointerId)return!1;if("touches"in e){let t=e.changedTouches[0];if(this.activePointer&&this.activePointer!==t.identifier)return!1}return!0}touchStart(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=e.changedTouches[0];this.activePointer=a.identifier;let d={target:t,pointerId:a.identifier,origin:w.getPoint(a,this.bounds),delta:[0,0],point:w.getPoint(a,this.bounds),pressure:w.getPressure(a),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}touchEnd(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=e.changedTouches[0],d={target:t,pointerId:a.identifier,origin:w.getPoint(a,this.bounds),delta:[0,0],point:w.getPoint(a,this.bounds),pressure:w.getPressure(a),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,this.activePointer=void 0,d}touchMove(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=e.changedTouches[0],d=this.pointer,l=w.getPoint(a,this.bounds),u=(d==null?void 0:d.point)?ie.Vec.sub(l,d.point):[0,0],p=$(g({origin:l},d),{target:t,pointerId:a.identifier,point:l,delta:u,pressure:w.getPressure(a),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]});return this.pointer=p,p}pointerDown(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=w.getPoint(e,this.bounds);this.activePointer=e.pointerId;let d={target:t,pointerId:e.pointerId,origin:a,point:a,delta:[0,0],pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}pointerEnter(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=w.getPoint(e,this.bounds),d={target:t,pointerId:e.pointerId,origin:a,delta:[0,0],point:a,pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}pointerMove(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=this.pointer,d=w.getPoint(e,this.bounds),l=(a==null?void 0:a.point)?ie.Vec.sub(d,a.point):[0,0],u=$(g({origin:d},a),{target:t,pointerId:e.pointerId,point:d,delta:l,pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]});return this.pointer=u,u}pointerUp(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=e,a=this.pointer,d=w.getPoint(e,this.bounds),l=(a==null?void 0:a.point)?ie.Vec.sub(d,a.point):[0,0];this.activePointer=void 0;let u=$(g({origin:d},a),{target:t,pointerId:e.pointerId,point:d,delta:l,pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]});return this.pointer=u,this.pointerUpTime=performance.now(),u}isDoubleClick(){if(!this.pointer)return!1;let{origin:e,point:t}=this.pointer,n=performance.now()-this.pointerUpTime<no&&ie.Vec.dist(e,t)<4;return n&&(this.activePointer=void 0),n}clear(){this.pointer=void 0}resetDoubleClick(){this.pointerUpTime=0}pinch(e,t){let{shiftKey:n,ctrlKey:o,metaKey:r,altKey:s}=this.keys,a=ie.Vec.sub(t,e),d={pointerId:0,target:"pinch",origin:t,delta:a,point:ie.Vec.sub(ie.Vec.toFixed(e),[this.bounds.minX,this.bounds.minY]),pressure:.5,shiftKey:n,ctrlKey:o,metaKey:S.isDarwin()?r:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}reset(){this.pointerUpTime=0,this.pointer=void 0,this.keyboard=void 0,this.activePointer=void 0,this.keys={}}static getPoint(e,t){return[+e.clientX.toFixed(2)-t.minX,+e.clientY.toFixed(2)-t.minY]}static getPressure(e){return"pressure"in e&&+e.pressure.toFixed(2)||.5}static commandKey(){return S.isDarwin()?"\u2318":"Ctrl"}},oo=new w;var ro=(0,Sn.observer)(function(C){var H=C,{id:e="tl",shapeUtils:t,page:n,pageState:o,assets:r=io,users:s,userId:a,theme:d,meta:l,snapLines:u,eraseLine:p,grid:c,containerRef:m,performanceMode:v,hideHandles:T=!1,hideIndicators:y=!1,hideCloneHandles:R=!1,hideBindingHandles:h=!1,hideResizeHandles:b=!1,hideRotateHandles:K=!1,hideBounds:Y=!1,hideGrid:M=!0,showDashedBrush:x=!1}=H,B=W(H,["id","shapeUtils","page","pageState","assets","users","userId","theme","meta","snapLines","eraseLine","grid","containerRef","performanceMode","hideHandles","hideIndicators","hideCloneHandles","hideBindingHandles","hideResizeHandles","hideRotateHandles","hideBounds","hideGrid","showDashedBrush"]);pt(d,"#"+e);let N=V.useRef(null),k=V.useRef(o);V.useEffect(()=>{k.current=o},[o]);let[Q,Hn]=V.useState(()=>({callbacks:B,shapeUtils:t,rSelectionBounds:N,rPageState:k,bounds:{minX:0,minY:0,maxX:1/0,maxY:1/0,width:1/0,height:1/0},inputs:new w})),In=V.useCallback(Mn=>{Hn(kn=>$(g({},kn),{bounds:Mn}))},[]);return V.createElement(he.Provider,{value:Q},V.createElement(Bn,{id:e,page:n,pageState:o,assets:r,snapLines:u,eraseLine:p,grid:c,users:s,userId:a,externalContainerRef:m,hideBounds:Y,hideIndicators:y,hideHandles:T,hideCloneHandles:R,hideBindingHandles:h,hideRotateHandle:K,hideResizeHandles:b,hideGrid:M,showDashedBrush:x,onBoundsChange:In,performanceMode:v,meta:l}))}),io={};var wn=require("mobx-react-lite"),pe=L(require("react")),so=pe.forwardRef(function(r,o){var s=r,{children:e,className:t=""}=s,n=W(s,["children","className"]);return pe.createElement(wn.Observer,null,()=>pe.createElement("div",g({ref:o,className:`tl-positioned-div ${t}`,draggable:!1},n),pe.createElement("div",{className:"tl-inner-div"},e)))});var Ne=L(require("react"));var Cn=require("@tldraw/intersect"),Ae=class{constructor(){P(this,"refMap",new Map);P(this,"boundsCache",new WeakMap);P(this,"showCloneHandles",!1);P(this,"hideBounds",!1);P(this,"isStateful",!1);P(this,"shouldRender",(e,t)=>!0);P(this,"getRef",e=>(this.refMap.has(e.id)||this.refMap.set(e.id,Ne.createRef()),this.refMap.get(e.id)));P(this,"hitTestBounds",(e,t)=>{let n=this.getBounds(e),o=I.getRotatedCorners(n,e.rotation);return o.every(r=>I.pointInBounds(r,t))||(0,Cn.intersectPolygonBounds)(o,t).length>0});P(this,"getRotatedBounds",e=>I.getBoundsFromPoints(I.getRotatedCorners(this.getBounds(e),e.rotation)))}};P(Ae,"Component",e=>Ne.forwardRef(e)),P(Ae,"Indicator",e=>e);module.exports=Nn(ao);
/**
 * String.prototype.replaceAll() polyfill
 * https://gomakethings.com/how-to-replace-a-section-of-a-string-with-another-one-with-vanilla-js/
 * @author Chris Ferdinandi
 * @license MIT
 */
//# sourceMappingURL=index.js.map
